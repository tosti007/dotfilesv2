#!/bin/bash
# Partially taken from https://gist.github.com/wandernauta/6800547

__usage="
Spotify-tui and Spotifyd wrapper commands

Usage: $(basename $0) [COMMAND] [OPTIONS]

Commands:
  [none]	Start the spotifyd process and spotify-tui screen
  play		Play music
  pause		Pause music
  play-pause	Toggle music
  next		Play the next track
  previous	Play the previous track
  status	Displays the current playing status
  current 	Displays the current track and artist
  lock		Pause the player if it's playing and save its state
  unlock 	Play the player if the saved state is playing

Options:
  -h, --help	Show this output
"

function controll {
	playerctl --player=spotifyd "$@"
}

function controll-start {
	systemctl --user start spotifyd.service
}

function controll-stop {
	~/.config/polybar/spotify.sh close
	systemctl --user stop spotifyd.service
}

case $1 in
-h | --help | help)
	echo "$__usage"
	exit 0
	;;
'')
	trap 'exit 0' INT TERM
	trap 'controll-stop' EXIT
	controll-start
	spt
	;;
current)
	controll metadata --format $'{{title}}\n{{artist}}' 2> /dev/null | sed \
		-e 's/(.*)//' \
		-e 's/\[.*\]//' \
		-e 's/-.*$//' \
		-e '2 s/,.*$//' \
		-e 's/  / /; s/^ //; s/ $//' | \
		sed 'N; s/\n/ â€” /'
	;;
play | pause | play-pause | next | previous | status)
	controll $1
	;;
lock)
	if [[ `$0 status` == 'Playing' ]]; then
	        $0 pause
        	touch /tmp/spotify_lock_resume
	fi
	;;
unlock)
	if [ -f /tmp/spotify_lock_resume ]; then
        	$0 play
	        rm /tmp/spotify_lock_resume 
	fi
	;;
*)
	echo "No such command"
	exit 1
esac

